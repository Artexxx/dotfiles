# Общие сочетания клавиш Fish

| **Сочетание клавиш** | **Описание действия** |
|----------------------|-----------------------|
| **Tab**              | Дополняет текущий токен. |
| **Shift+Tab**        | Дополняет текущий токен и запускает поиск в пейджере. |
| **← / →**            | Перемещает курсор на один символ влево/вправо. Если курсор в конце строки и есть автоподсказка, стрелка вправо принимает её. |
| **Enter**            | Выполняет текущую команду или добавляет перенос строки, если команда не завершена (например, отсутствует `)` или `end`). |
| **Alt+Enter**        | Вставляет перенос строки в позицию курсора. |
| **Alt+← / Alt+→**    | Перемещает курсор на одно слово влево/вправо (до следующего пробела или знака пунктуации). Если строка пустая, перемещает по истории директорий. При наличии автоподсказки `Alt+→` принимает первое слово из подсказки. |
| **Control+← / Control+→** | Перемещает курсор на одно слово влево/вправо, принимая одно слово из автоподсказки. |
| **Shift+← / Shift+→** | Перемещает курсор на "большое слово" влево/вправо (не останавливается на пунктуации). Принимает целую "группу слов" из автоподсказки. |
| **↑ / ↓**            | Поиск по истории команд вверх/вниз. Если строка пустая, показываются все команды. |
| **Alt+↑ / Alt+↓**    | Поиск по истории команд по токену под курсором. Если курсор не находится на токене, ищутся все токены. |
| **Control+C**        | Прерывает или завершает выполняющуюся команду (SIGINT). |
| **Control+D**        | Удаляет символ справа от курсора. Если строка пустая, завершает сессию Fish. |
| **Control+U**        | Удаляет содержимое строки от начала до курсора и помещает его в "killring". |
| **Control+L**        | Очищает экран и перерисовывает содержимое. |
| **Control+W**        | Удаляет предыдущий компонент пути (до `/`, `:` или `@`) и помещает его в "killring". |
| **Control+X**        | Копирует текущий буфер в системный буфер обмена. |
| **Control+V**        | Вставляет содержимое буфера обмена. |
| **Alt+D**            | Удаляет следующее слово и помещает его в "killring". |
| **Alt+H / F1**       | Открывает страницу справки для текущей команды (если доступна). |
| **Alt+L**            | Показывает содержимое текущей директории. Если курсор находится на аргументе директории, отображается её содержимое. |
| **Alt+O**            | Открывает файл под курсором в пейджере. |
| **Alt+P**            | Добавляет `&| less` к концу команды, чтобы результат выводился постранично. |
| **Alt+W**            | Показывает краткое описание команды под курсором. |
| **Alt+E / Alt+V**    | Открывает текущую команду для редактирования во внешнем редакторе (выбирается из переменных `$VISUAL` или `$EDITOR`). |
| **Alt+S**            | Добавляет `sudo` перед текущей командой. Если строка пустая, добавляет `sudo` к последней выполненной команде. |
| **Control+Space**    | Вставляет пробел без разворачивания аббревиатуры. Работает только в режиме вставки (insert mode) при использовании vi-режима. |

# Команды Vi-режима в Fish

В Vi-режиме Fish поддерживаются команды для управления строкой в различных режимах: **command mode** (нормальный режим), **insert mode** (режим вставки) и **visual mode** (режим выделения).

---

## **Общие команды Vi-режима**

| **Команда**         | **Действие**                                                                                                    |
|---------------------|-----------------------------------------------------------------------------------------------------------------|
| **fish_vi_key_bindings** | Включает Vi-режим.                                                                                           |
| **fish_default_key_bindings -M insert** | Добавляет все комбинации из Emacs-режима в Vi-режим для режима вставки.                          |
| **fish_mode_prompt** | Отображает индикатор текущего режима слева от командной строки.                                                  |
| **fish_vi_cursor**   | Управляет формой курсора в зависимости от режима (поддерживаемые формы: block, line, underscore).                |

### Настройки курсора:
- `fish_cursor_default`: Форма курсора в командном режиме (по умолчанию — блок).
- `fish_cursor_insert`: Форма курсора в режиме вставки (по умолчанию — линия).
- `fish_cursor_replace`: Форма курсора в режиме замены (по умолчанию — подчёркивание).

---

## **Command Mode (Нормальный режим)**

| **Команда**         | **Действие**                                                                                                    |
|---------------------|-----------------------------------------------------------------------------------------------------------------|
| `h`                 | Перемещает курсор влево.                                                                                        |
| `l`                 | Перемещает курсор вправо.                                                                                       |
| `k` / `j`           | Перемещает курсор вверх/вниз по истории команд или строкам многострочной команды.                               |
| `i`                 | Входит в режим вставки на текущей позиции курсора.                                                              |
| `Shift+I`           | Входит в режим вставки в начале строки.                                                                         |
| `a`                 | Входит в режим вставки после текущей позиции курсора.                                                           |
| `Shift+A`           | Входит в режим вставки в конце строки.                                                                          |
| `o`                 | Вставляет новую строку ниже текущей и входит в режим вставки.                                                   |
| `O`                 | Вставляет новую строку выше текущей и входит в режим вставки.                                                   |
| `0` (ноль)          | Перемещает курсор в начало строки.                                                                              |
| `d+d`               | Удаляет текущую строку и копирует её в буфер обмена ("Kill Ring").                                              |
| `Shift+D`           | Удаляет текст от курсора до конца строки и копирует его в буфер обмена.                                         |
| `p`                 | Вставляет содержимое буфера обмена.                                                                             |
| `u`                 | Отменяет последнее изменение строки.                                                                            |
| `Control+R`         | Возвращает отменённое изменение.                                                                                |
| `[` / `]`           | Ищет предыдущий/следующий токен по истории команд.                                                              |
| `/`                 | Открывает историю команд с постраничным поиском по ключевому слову.                                             |
| `Backspace`         | Перемещает курсор влево.                                                                                        |
| `g` / `G`           | Перемещает курсор в начало/конец строки.                                                                        |
| `:q`                | Завершает работу Fish.                                                                                          |

---

## **Insert Mode (Режим вставки)**

| **Команда**         | **Действие**                                                                                                    |
|---------------------|-----------------------------------------------------------------------------------------------------------------|
| `Escape`            | Переходит в командный режим.                                                                                    |
| `Backspace`         | Удаляет один символ слева от курсора.                                                                           |

---

## **Visual Mode (Режим выделения)**

| **Команда**         | **Действие**                                                                                                    |
|---------------------|-----------------------------------------------------------------------------------------------------------------|
| `←` / `→`           | Расширяет выделение на один символ влево/вправо.                                                                |
| `h` / `l`           | Перемещает курсор влево/вправо.                                                                                 |
| `k` / `j`           | Перемещает курсор вверх/вниз.                                                                                   |
| `b` / `w`           | Расширяет выделение на одно слово назад/вперёд.                                                                 |
| `d` / `x`           | Вырезает выделение и переходит в командный режим.                                                               |
| `Escape`, `Control+C` | Переход в командный режим.                                                                                     |
| `c` / `s`           | Удаляет выделение и переходит в режим вставки.                                                                  |
| `X`                 | Вырезает текущую строку и переходит в командный режим.                                                          |
| `y`                 | Копирует выделение в буфер обмена и переходит в командный режим.                                                |
| `~`                 | Переключает регистр выделенного текста (верхний/нижний) и переходит в командный режим.                         |
| `"*y`               | Копирует выделение в системный буфер обмена и переходит в командный режим.                                      |

# Пользовательские привязки клавиш в Fish

Fish позволяет создавать собственные привязки клавиш с помощью команды `bind`.

## **Создание пользовательских привязок**

Пример: очистка командной строки при нажатии `Control+C`:
```bash
bind \cc 'commandline -r ""'
```
Эти команды можно добавить в файл `config.fish` или в функцию `fish_user_key_bindings`.

---

## **Удаление пользовательских привязок**

Чтобы вернуть привязку по умолчанию, используйте:
```bash
bind --erase \cc
```
После удаления пользовательской привязки Fish автоматически применяет стандартную привязку.

---

## **Привязки для режимов Vi**

По умолчанию команда `bind` создаёт привязку для командного режима Vi. Чтобы задать привязку для режима вставки:
```bash
bind --mode insert \cc 'commandline -r ""'
```

---

## **Последовательности нажатий клавиш**

Некоторые клавиши передают терминалу простой символ (например, `a`). Однако для некоторых клавиш используются сложные последовательности байт, которые могут различаться между терминалами.

### **Использование `fish_key_reader`**

Чтобы узнать последовательность байт для привязки, используйте `fish_key_reader`:
```bash
fish_key_reader  # Нажмите клавишу для проверки
Press a key:
```
Пример:
- `Control+C` → `bind \cC 'do something'`
- Стрелка вправо → `bind \e\[C 'do something'`

---

## **Ограничения привязок**

Некоторые комбинации клавиш невозможно отличить или привязать. Например:
- `Control+I` — то же, что и клавиша `Tab`.
- `Escape` и `Alt` работают одинаково в терминале.

### **Настройка задержки распознавания Escape:**
Чтобы увеличить задержку для распознавания `Alt` или `Escape`, настройте переменную `fish_escape_delay_ms`:
```bash
set -g fish_escape_delay_ms 100
```

---

## **Настройка последовательностей команд**

Чтобы Fish не ждал вторую клавишу в последовательности слишком долго:
```bash
bind -M insert -m default jk cancel repaint-mode  # Привязка для выхода в нормальный режим Vi
set -g fish_sequence_key_delay_ms 200  # Ждёт 200 мс для завершения последовательности
```

---

## **Буфер обмена (Kill Ring)**

Fish использует буфер обмена в стиле Emacs для функций копирования и вставки.

| **Команда** | **Действие**                                 |
|-------------|----------------------------------------------|
| `Control+K` | Вырезает текст от курсора до конца строки.   |
| `Control+Y` | Вставляет последний элемент из буфера обмена (Yank). |
| `Alt+Y`     | Вставляет предыдущий элемент из буфера.      |
| `Control+X` | Копирует текущую строку в системный буфер обмена. |
| `Control+V` | Вставляет содержимое системного буфера обмена. |

Fish поддерживает команды `fish_clipboard_copy` и `fish_clipboard_paste`, которые используют утилиты `xsel`, `xclip`, `wl-copy`, `pbcopy` и другие.

### **Автоэкранирование при вставке**

При вставке текста внутрь одиночных кавычек Fish автоматически экранирует одиночные кавычки и обратные слэши, чтобы вставленный текст был корректным.

---

## **Выделение текста**

Команды `begin-selection` и `end-selection` управляют выделением текста. Параметр `fish_cursor_selection_mode` регулирует, включается ли символ под курсором в выделение.

| **Режим выделения** | **Описание**                |
|---------------------|-----------------------------|
| `exclusive`         | Символ под курсором не выделяется. |
| `inclusive`         | Символ под курсором выделяется.    |

По умолчанию используется `exclusive`, но для режима Vi и курсоров типа "блок" или "подчёркивание" может быть удобнее `inclusive`.

---

## **Редактирование многострочных команд**

Fish поддерживает редактирование многострочных команд. Способы добавления новой строки:
1. Нажать `Enter`, если блок команд (например, `for`, `begin`, `if`) не завершён.
2. Нажать `Alt+Enter`.
3. Добавить символ `\` перед `Enter` для экранирования новой строки.
